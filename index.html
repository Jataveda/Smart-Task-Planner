<!-- frontend/index.html -->
<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Smart Task Planner — Demo</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: system-ui, -apple-system, Arial; margin: 24px; color:#111; }
    input, textarea { width:100%; padding:8px; margin:6px 0; box-sizing:border-box; }
    button { padding:8px 12px; margin-top:8px; cursor:pointer; }
    .task { border:1px solid #ddd; padding:12px; border-radius:6px; margin-bottom:8px; }
    .meta { color:#555; font-size:0.9em }
  </style>
</head>
<body>
  <h1>Smart Task Planner — Demo</h1>

  <label for="goal">Enter your goal (e.g., "Launch a product in 2 weeks")</label>
  <textarea id="goal" rows="2">Launch a product in 2 weeks</textarea>
  <label for="owner">Your name (optional)</label>
  <input id="owner" placeholder="Alice" />
  <button id="go">Generate Plan</button>

  <h2>Result</h2>
  <div id="result">
    <em>Submit a goal to generate a task plan.</em>
  </div>

<script>
const apiBase = "http://localhost:8000";

document.getElementById('go').onclick = async () => {
  const goal = document.getElementById('goal').value.trim();
  const owner = document.getElementById('owner').value.trim();
  if (!goal) { alert("Please enter a goal."); return; }
  document.getElementById('result').innerHTML = "<em>Generating plan... (this is local demo)</em>";
  try {
    const res = await fetch(apiBase + "/generate-plan", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ goal_text: goal, owner })
    });
    if (!res.ok) {
      const err = await res.json();
      document.getElementById('result').innerHTML = "<strong>Error:</strong> " + (err.detail || res.statusText);
      return;
    }
    const data = await res.json();
    renderPlan(data);
  } catch (e) {
    document.getElementById('result').innerHTML = "<strong>Network Error:</strong> " + e.message;
  }
};

function renderPlan(plan) {
  const out = document.getElementById('result');
  let html = `<div class="meta">Goal: <strong>${escapeHtml(plan.goal_text)}</strong> — Created by: ${escapeHtml(plan.created_by || "unknown")}</div>`;
  html += `<div class="meta">Created on: ${escapeHtml(plan.created_on || "")}</div>`;
  if (!plan.tasks || plan.tasks.length === 0) {
    html += "<p>No tasks generated.</p>";
  } else {
    for (const t of plan.tasks) {
      html += `<div class="task">
        <h3>${escapeHtml(t.title)}</h3>
        <div class="meta">${escapeHtml(t.start_date || "")} → ${escapeHtml(t.end_date || "")} | depends on: ${escapeHtml(t.depends_on || "none")}</div>
        <p>${escapeHtml(t.description || "")}</p>
      </div>`;
    }
  }
  out.innerHTML = html;
}

function escapeHtml(s) {
  if (!s) return "";
  return s.replace(/[&<>"'\/]/g, function (c) {
    return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;','/':'&#47;'}[c];
  });
}
</script>
</body>
</html>

